import{u as e,F as s}from"./useForm-0cf5fadd.js";import{s as a}from"./issue.data-090d6248.js";import{_ as t}from"./ContentWrap.vue_vue_type_script_setup_true_lang-b07c8c79.js";import{e as o,K as r,L as i,r as l,o as u,l as n,m,x as p,k as c,D as d,a6 as f,as as _}from"./index-dc787e95.js";import{E as v}from"./el-button-adf54e9f.js";import{_ as j}from"./style.css_vue_type_style_index_0_src_true_lang-a67dba02.js";import{u as y}from"./useValidator-ce35917e.js";import{g,a as h,b as w,p as x}from"./issue-fd8ae597.js";import"./el-col-8a867eaa.js";import"./el-popper-06627937.js";import"./use-form-common-props-e92a1987.js";import"./el-divider-7e837124.js";import"./event-5568c9d8.js";import"./use-form-item-cb2ecb0c.js";import"./el-checkbox-8998332c.js";import"./el-switch-54b2e8b0.js";import"./_plugin-vue_export-helper-1b428a4d.js";import"./index-7a6ce827.js";import"./index-2bc17c13.js";import"./el-card-4ec964b4.js";const F=o({name:"HelpIssueForm",setup(o,{expose:F}){const{required:V}=y(),{push:b,currentRoute:k}=r(),{register:R,methods:C,elFormRef:D}=e({schema:a}),I=i({title:[V()],content:[V()],category_id:[V()]}),q=l("");(async()=>{const e=k.value.query.id;if(e){q.value="edit";const s=await g(Number(e));if(s){const{setValues:e}=C;e(s.data)}else b("/404")}else q.value="add"})();(async()=>{const{setSchema:e}=C;e([{field:"category_id",path:"componentProps.options",value:(await h()).data}])})();const A=l(),P={customAlert:(e,s)=>{switch(s){case"success":f.success(e);break;case"info":default:f.info(e);break;case"warning":f.warning(e);break;case"error":f.error(e)}},autoFocus:!1,scroll:!0,readOnly:!1,uploadImgShowBase64:!0,placeholder:"请输入内容..."},S=l(!1),U=async()=>{const e=c(D);await(null==e?void 0:e.validate((async e=>{if(e){S.value=!0;let e=await C.getFormData();if(!e)return S.value=!1,f.error("未获取到数据");const s=_(),a=l({});try{"add"===q.value?(a.value=await w(e),a.value&&(s.delView(c(k)),b("/help/issue"))):"edit"===q.value&&(a.value=await x(e),a.value&&(s.delView(c(k)),b("/help/issue")))}finally{S.value=!1}}})))};return F({elFormRef:D,getFormData:C.getFormData}),(e,a)=>(u(),n(c(t),null,{default:m((()=>[p(c(s),{class:"issue-form",rules:I,onRegister:c(R)},{content:m((e=>[p(c(j),{modelValue:e.content,"onUpdate:modelValue":s=>e.content=s,ref_key:"editorRef",ref:A,editorId:"issueContent",editorConfig:P},null,8,["modelValue","onUpdate:modelValue"])])),active:m((()=>[p(c(v),{type:"primary",onClick:U},{default:m((()=>[d("立即保存")])),_:1})])),_:1},8,["rules","onRegister"])])),_:1}))}});export{F as default};
