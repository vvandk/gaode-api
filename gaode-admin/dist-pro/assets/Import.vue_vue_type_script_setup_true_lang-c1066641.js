import{e,r as a,o as l,j as t,y as s,x as r,m as n,D as i,k as o,z as u,l as p,W as d,a6 as m,am as c,an as f}from"./index-dc787e95.js";import{E as _}from"./el-link-926ced33.js";import{E as b,a as y}from"./el-col-8a867eaa.js";import{E as v}from"./el-button-adf54e9f.js";import{E as g,a as h}from"./el-popover-85004fb7.js";import"./el-checkbox-8998332c.js";import{E as w}from"./el-popper-06627937.js";import{E as x}from"./el-progress-82737459.js";import{E as k}from"./el-popconfirm-1d6b4668.js";const E=s("span",null,"导入步骤：",-1),j={style:{"margin-top":"7px"}},z=s("li",{style:{"margin-top":"7px"}},"编辑模板文件，（将需要导入的数据按格式填写进去）",-1),C=s("li",{style:{"margin-top":"7px"}},"上传模板文件，点击确认导入",-1),L=s("li",{style:{"margin-top":"7px"}},"查看导入结果，是否全部导入",-1),X={class:"mt-10px"},M={class:"flex justify-between mr-10px"},B=s("span",null,"导入结果",-1),D={style:{color:"red"}},F=e({__name:"Import",emits:["getList"],setup(e,{emit:F}){const S=e=>{const a=["application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"].includes(e.type),l=e.size/1024/1024<10;return a||m.error("上传文件必须是 XLSX 格式!"),l||m.error("上传文件大小不能超过 10MB!"),a&&l},q=a(),I=a([]),K=a([]),Q=async e=>{I.value=[],I.value.push({filename:e.file.name,filesize:(e.file.size/1024).toFixed(1)+"KB",status:"上传成功"}),q.value=e.file},W=()=>{I.value=[],q.value=null},Y=a(!1),A=a(0),G=async()=>{Y.value=!0;const e=new FormData;e.append("file",q.value);try{const a=await c(e);a&&(K.value.push({filename:q.value.name,success_number:a.data.success_number,error_number:a.data.error_number,error_url:a.data.error_url}),A.value+=a.data.success_number,W(),F("getList"))}finally{Y.value=!1}},H=async()=>{m.info("正在下载请稍等！");const e=await f();if(e){const a=document.createElement("a");a.style.display="none",a.href=e.data.url,a.target="_blank",a.download=e.data.filename;const l=new MouseEvent("click");a.dispatchEvent(l)}};return(e,a)=>(l(),t(d,null,[s("div",null,[E,s("ol",null,[s("li",j,[r(o(_),{onClick:H,target:"_blank",type:"primary"},{default:n((()=>[i(" 下载最新批量导入模板 ")])),_:1})]),z,C,L])]),s("div",null,[r(o(y),{gutter:10,class:"!mt-0 !mr-0"},{default:n((()=>[r(o(b),{span:1.5},{default:n((()=>[s("div",null,[r(o(x),{action:"","http-request":Q,data:{path:"users"},"show-file-list":!1,"before-upload":S,accept:".xlsx",disabled:I.value.length>0},{default:n((()=>[r(o(w),{effect:"dark",content:"只支持上传XLSX文件",placement:"top"},{default:n((()=>[r(o(v),{type:"primary",size:"small",disabled:I.value.length>0},{default:n((()=>[i("上传文件")])),_:1},8,["disabled"])])),_:1})])),_:1},8,["disabled"])])])),_:1}),r(o(b),{span:1.5},{default:n((()=>[r(o(v),{type:"primary",size:"small",disabled:0===I.value.length,loading:Y.value,onClick:G},{default:n((()=>[i("确认导入")])),_:1},8,["disabled","loading"])])),_:1})])),_:1}),r(o(h),{data:I.value,border:!0,style:{width:"100%"},class:"mt-10px"},{default:n((()=>[r(o(g),{prop:"filename",label:"文件名称",align:"left"}),r(o(g),{prop:"filesize",label:"文件大小",width:"100",align:"center"}),r(o(g),{prop:"status",label:"上传状态",width:"100",align:"center"}),r(o(g),{fixed:"right",label:"操作",width:"130",align:"center"},{default:n((()=>[r(o(k),{title:"确认删除吗?",onConfirm:W},{reference:n((()=>[r(o(v),{link:"",type:"primary",size:"small"},{default:n((()=>[i("删除")])),_:1})])),_:1})])),_:1})])),_:1},8,["data"])]),s("div",X,[s("div",M,[B,s("span",null,"成功导入总数："+u(A.value),1)]),r(o(h),{data:K.value,border:!0,style:{width:"100%"},class:"mt-10px"},{default:n((()=>[r(o(g),{prop:"filename",label:"文件名称",align:"left"}),r(o(g),{prop:"success_number",label:"成功数量",width:"100",align:"center"}),r(o(g),{prop:"error_number",label:"失败数量",width:"100",align:"center"},{default:n((e=>[s("span",D,u(e.row.error_number),1)])),_:1}),r(o(g),{fixed:"right",label:"操作",width:"130",align:"center"},{default:n((e=>[e.row.error_number>0?(l(),p(o(_),{key:0,onClick:a=>(async e=>{m.info("正在下载请稍等！");const a=document.createElement("a");a.style.display="none",a.href=e.error_url,a.target="_blank",a.download=e.filename;const l=new MouseEvent("click");a.dispatchEvent(l)})(e.row),target:"_blank",type:"primary"},{default:n((()=>[i("下载失败数据")])),_:2},1032,["onClick"])):(l(),p(o(_),{key:1,type:"success",underline:!1},{default:n((()=>[i("成功全部导入")])),_:1}))])),_:1})])),_:1},8,["data"])])],64))}});export{F as _};
