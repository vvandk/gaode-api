import{_ as e}from"./ContentWrap.vue_vue_type_script_setup_true_lang-b07c8c79.js";import{u as t,_ as a,a as o}from"./RightToolbar.vue_vue_type_script_setup_true_lang-44d08f8c.js";import{a0 as s,L as i,ac as n,ad as l,e as r,P as c,r as p,w as d,K as m,aa as u,v as h,f,a8 as x,o as y,l as v,m as _,x as g,k as w,y as b,D as k,z as j,M as E,ab as S}from"./index-dc787e95.js";import{a as O,E as W}from"./el-col-8a867eaa.js";import{E as C}from"./el-button-adf54e9f.js";import{E as z}from"./el-popper-06627937.js";import{_ as A}from"./Search.vue_vue_type_script_setup_true_lang-d97129cd.js";import{u as R}from"./dict-37e95629.js";import"./el-card-4ec964b4.js";import"./el-popover-85004fb7.js";import"./el-checkbox-8998332c.js";import"./event-5568c9d8.js";import"./use-form-common-props-e92a1987.js";import"./use-form-item-cb2ecb0c.js";import"./el-divider-7e837124.js";import"./useForm-0cf5fadd.js";import"./el-switch-54b2e8b0.js";import"./_plugin-vue_export-helper-1b428a4d.js";import"./index-7a6ce827.js";import"./index-2bc17c13.js";import"./el-overlay-9a40cbcb.js";import"./vnode-7d8ea85e.js";import"./el-dropdown-item-978ba092.js";import"./dict-416d98d1.js";const P=e=>s.post({url:"/sadmin/amap/search/poi/2/0",params:e}),L=i([{type:"index",field:"index",label:"",show:!0,disabled:!1,span:24},{field:"name",label:"店铺名称",show:!0,disabled:!0,span:24},{field:"tel",label:"电话号",show:!0,span:24},{field:"rating",label:"评分",show:!1,width:"100px",span:24},{field:"address",label:"地址",show:!0,minWidth:"120px",span:24},{field:"type",label:"经营类型",show:!0,minWidth:"120px",span:24},{field:"photos",label:"门店信息",show:!0,minWidth:"120px",span:24}]),N=i([{field:"adcode",label:"市县名称",component:"SelectV2",componentProps:{filterable:!0,options:[],style:{width:"300px"},placeholder:"请选择市县名称，也可以直接输入筛选"}},{field:"poi",label:"类别",component:"SelectV2",componentProps:{filterable:!0,options:[],style:{width:"300px"},placeholder:"请选择类别，也可以直接输入筛选"}}]),U=i([{key:"name",title:"店铺名称",type:"text"},{key:"tel",title:"电话号",type:"text"},{key:"rating",title:"评分",type:"text"},{key:"address",title:"地址",type:"text"},{key:"type",title:"经营类型",type:"text"},{key:"photos",title:"门店信息",type:"text"}]);var M,T,F,I={exports:{}};
/*!
 * js-table2excel v1.1.2
 * Released under the MIT License.
 * repository: https://github.com/hxj9102/table2excel.git
 */const D=l(I.exports=(M=function(e,t){var a;"ie"==((a=window.navigator.userAgent).indexOf("MSIE")>=0?"ie":a.indexOf("Firefox")>=0?"Firefox":a.indexOf("Chrome")>=0?"Chrome":a.indexOf("Opera")>=0?"Opera":a.indexOf("Safari")>=0?"Safari":void 0)?T(e):F(e,t)},T=function(e,t){var a=e,o=new ActiveXObject("Excel.Application"),s=o.Workbooks.Add(),i=s.Worksheets(1),n=document.body.createTextRange();n.moveToElementText(a),n.select,n.execCommand("Copy"),i.Paste(),o.Visible=!0;try{o.Application.GetSaveAsFilename("Excel.xls","Excel Spreadsheets (*.xls), *.xls")}catch(l){print("Nested catch caught "+l)}finally{s.SaveAs(fname),s.Close(savechanges=!1),o.Quit(),o=null,window.setInterval("Cleanup();",1),window.setInterval("Cleanup();",1)}},F=function(e,t){var a,o,s="data:application/vnd.ms-excel;base64,"+(a={worksheet:t,table:e},o='<html xmlns:o="urn:schemas-microsoft-com:office:office" xmlns:x="urn:schemas-microsoft-com:office:excel" xmlns="http://www.w3.org/TR/REC-html40"><head><meta charset="UTF-8">\x3c!--[if gte mso 9]><xml><x:ExcelWorkbook><x:ExcelWorksheets><x:ExcelWorksheet><x:Name>{worksheet}</x:Name><x:WorksheetOptions><x:DisplayGridlines/></x:WorksheetOptions></x:ExcelWorksheet></x:ExcelWorksheets></x:ExcelWorkbook></xml><![endif]--\x3e</head><body><table>{table}</table></body></html>'.replace(/{(\w+)}/g,(function(e,t){return a[t]})),window.btoa(unescape(encodeURIComponent(o))));if(navigator.userAgent.indexOf("Firefox")>-1)window.location.href=s;else{var i,n=document.createElement("a");n.href=s,n.download=t||"",window.MouseEvent?i=new MouseEvent("click"):(i=document.createEvent("MouseEvents")).initMouseEvent("click",!0,!1,window,0,0,0,0,0,!1,!1,!1,!1,0,null),n.dispatchEvent(i)}},function(){for(var e={image:function(e,t){return t=Object.assign({width:40,height:60},t),'<td style="width: '.concat(t.width,"px; height: ").concat(t.height,'px; text-align: center; vertical-align: middle"><img src="').concat(e,'" width=').concat(.99*t.width," height=").concat(.99*t.height," /></td>")},text:function(e){return'<td style="text-align: center">'.concat(e,"</td>")}},t=arguments.length,a=new Array(t),o=0;o<t;o++)a[o]=arguments[o];var s,i=1===(s=a).length?s[0]:{column:s[0]||[],data:s[1]||[],excelName:s[2]||"",captionName:s[3]},n=i.column,l=i.data,r=i.excelName,c=i.captionName,p=c?'<caption style="font-weight:bold">'.concat(c,"</caption>"):"",d=n.reduce((function(e,t){return e+"<th>".concat(t.title,"</th>")}),"");d="<thead><tr>".concat(d,"</tr></thead>");var m=l.reduce((function(t,a){var o=n.reduce((function(t,o){var s={};return"image"===o.type&&(a.size?(s.width=a.size[0],s.height=a.size[1]):(o.width&&(s.width=o.width),o.height&&(s.height=o.height))),t+e[o.type||"text"](a[o.key],s)}),"");return t+"<tr>".concat(o,"</tr>")}),"");m="<tbody>".concat(m,"</tbody>"),M(p+d+m,r)})),G={class:"mb-8px flex justify-between"},V={class:"text-[14px]"},Q={class:"text-[14px]"},X=r({name:"AmapPoi",setup(i){const{wsCache:n}=c(),{register:l,elTableRef:r,tableObject:M,methods:T}=t({getListApi:P,response:{data:"data",count:"count"}}),F=p([]);(async()=>{const e=R(),t=await e.getDictObj(["sys_sadmin_poi_adcode","sys_sadmin_poi_poi"]);F.value.push({field:"adcode",path:"componentProps.options",value:t.sys_sadmin_poi_adcode}),F.value.push({field:"poi",path:"componentProps.options",value:t.sys_sadmin_poi_poi})})();const{getList:I,setSearchParams:X}=T,q=p("default");d(q,(e=>{q.value=e}));const{currentRoute:J}=m(),K=J.value.fullPath;d(L,(async e=>{var t;n.set(K,JSON.stringify(e)),await u(),null==(t=r.value)||t.doLayout()}),{deep:!0});const Y=()=>{D(U,M.tableData,"高德")},Z=async()=>{M.loading=!0;const e=await(t=w(M.params),s.post({url:"/sadmin/amap/export/poi/data/to/excel",params:t})).finally((()=>{M.loading=!1}));var t;if(e){const t=document.createElement("a");t.style.display="none",t.href=e.data.url,t.target="_blank",t.download=e.data.filename;const a=new MouseEvent("click");t.dispatchEvent(a)}},$=async()=>{await B.setUserInfo()},B=h(),H=f((()=>B.getUser));M.loading=!1;const ee=25;return(t,s)=>{const i=x("Icon");return y(),v(w(e),null,{default:_((()=>[g(w(A),{schema:w(N),setSchemaList:F.value,onSearch:w(X),onReset:w(X)},null,8,["schema","setSchemaList","onSearch","onReset"]),b("div",G,[g(w(O),{gutter:10},{default:_((()=>[g(w(W),{span:1.5},{default:_((()=>[g(w(C),{type:"primary",onClick:Y},{default:_((()=>[k("导出查询结果到Excel（不消耗次数）")])),_:1})])),_:1}),g(w(W),{span:1.5},{default:_((()=>[g(w(C),{type:"primary",onClick:Z},{default:_((()=>[k("导出类别所有数据到Excel（每25条数据消耗一次）")])),_:1})])),_:1}),g(w(W),{span:1.5},{default:_((()=>[g(w(C),{type:"primary",onClick:$},{default:_((()=>[k("刷新当前的次数")])),_:1})])),_:1}),"0"===H.value.poi_search_restrict_method?(y(),v(w(W),{key:0,span:1.5},{default:_((()=>[b("span",V,"今日剩余次数："+j(H.value.poi_search_residual_day_number),1)])),_:1})):E("",!0),"1"===H.value.poi_search_restrict_method?(y(),v(w(W),{key:1,span:1.5},{default:_((()=>[b("span",Q,"剩余次数："+j(H.value.poi_search_residual_total_number),1)])),_:1})):E("",!0),g(w(W),{span:1.5},{default:_((()=>[g(w(z),{effect:"dark",content:"每查询一次都会消耗一次，并且每翻页一次同样会消耗一次",placement:"top"},{default:_((()=>[g(i,{icon:"ph:question-fill"})])),_:1})])),_:1})])),_:1}),g(w(a),{onGetList:w(I),"table-size":q.value,"onUpdate:tableSize":s[0]||(s[0]=e=>q.value=e),columns:w(L),"onUpdate:columns":s[1]||(s[1]=e=>S(L)?L.value=e:null),"cache-table-headers-key":w(K)},null,8,["onGetList","table-size","columns","cache-table-headers-key"])]),g(w(o),{limit:ee,"onUpdate:limit":s[2]||(s[2]=e=>ee=e),page:w(M).page,"onUpdate:page":s[3]||(s[3]=e=>w(M).page=e),columns:w(L),data:w(M).tableData,loading:w(M).loading,selection:!1,size:q.value,border:!0,pagination:{total:w(M).count,pageSizes:[25],layout:"sizes, prev, pager, next, jumper, ->"},onRegister:w(l)},null,8,["page","columns","data","loading","size","pagination","onRegister"])])),_:1})}}});export{X as default};
